<h1 lang="fa" dir="rtl" align="right">راه‌اندازی پراکسی در لینوکس</h1>
<p lang="fa" dir="rtl" align="right">یکی از اولین نیازها برای مهاجرت به لینوکس استفاده از پراکسی هست، متاسفانه آموزش‌های مناسبی هم براش سراغ ندارم در نتیجه تصمیم گرفتم این آموزش رو بنویسم، امیدوارم برای تازه کاران مفید باشه.<br>سعی می‌کنم به مرور زمان تکمیلش کنم شما هم می‌تونید کمک کنید ایراداش رو بگید روش‌های دیگه رو آموزش بدید.<br>منتظر ایشو‌ها یا پول ریکوست‌هاتون هستم.</p>
<p lang="fa" dir="rtl" align="right">توضیح: من سواد لینوکسی، شبکه‌ای، فارسی زیادی ندارم در نتیجه ممکنه هرجا متن اشتباه باشه.</p>
<p lang="fa" dir="rtl" align="right">برای اینکه بتونیم تحریم‌هارو دور بزنیم لازمه با ip غیر از ip ایران به اینترنت وصل بشیم. برای اینکار میشه تونلی به یک سرور خارج ایران زد و بعد ترافیک اینترنت رو از اون تونل انتقال داد. پس آموزش به دو قسمت کلی تقسیم میشه: ساخت تونل و رد کردن ترافیک از توش </p>
<p lang="fa" dir="rtl" align="right">حواستون باشه میرورهای موجود در ایران ممکنه برنامه‌هایی که برای دور زدن استفاده می‌شه رو نداشته باشند در نتیجه از میرورهای خارج ایران استفاده کنید. (یادتون نره لیست مخازنن رو آپدیت کنید)</p>
<h2 lang="fa" dir="rtl" align="right">ساخت تونل</h2>
<p lang="fa" dir="rtl" align="right">نکته: این تونل‌ها تا زمانی که ترمینال باز هست کار می‌کنه و با بستن ترمینال بسته می‌شه. اگر می‌خواید ترمینال رو ببندید می‌تونید اول دستور screen و یا nohup رو بزنید تا تونل با بستن ترمینال باز بمونه (ممکنه لازم باشه screen و nohup رو نصب کنید) ولی من پیشنهاد میدم یه گوشه‌های باز نگهش دارید تا اگر خطایی داد ببنید مشکل چیه</p>
<h2 lang="fa" dir="rtl" align="right">راه‌اندازی تونل به وسیله shadow socks</h2>
<p lang="fa" dir="rtl" align="right">شدو ساکس یکی از راه‌های ساخت تونل هست لازمه شما یه سرور در خارج از ایران داشته باشید از سیستم خودتون بهش وصل بشید
سمت سرور رو فکر نکنم لازم باشه بگم چون تصورم اینه که اگر سرور داشته باشید می‌تونید شدو ساکس رو هم نصب کنید ولی اگر خواستید اضافش می‌کنم.</p>

```bash
$ sudo apt install libevent-dev
$ sudo apt install python-pip
$ sudo apt install python-dev
$ sudo apt install python-m2crypto
$ sudo pip install gevent
$ sudo pip install shadowsocks
```

<p lang="fa" dir="rtl" align="right">الان شدو ساکس رو سیستم شما نصب شده و با دستور زیر می‌تونید یک تونل رو سیستم خودتون ایجاد کنید.</p>

```bash
$ sslocal -s “server” -k password -t 600 -p port  -l 1080 -m encryption
```

<p lang="fa" dir="rtl" align="right">به جای "server" آی‌پی یا آدرس سرور، به جای "password" پسورد و جای "port" پورت، جای "encryption" انکریپشن سرویس رو وارد کنید و به جای "local port" پورت لوکال سیستم که خودتون تایینش می‌کنید. بعد تونل رو سیستم شما ایجاد میشه و باید به مرحله رد کردن ترافیک از تونل برید.</p>
<p lang="fa" dir="rtl" align="right">میشه دستورات بالا رو تو یه فایل به این شکل ذخیره کرد</p>

```json
{
  "server": "sever addr",
  "server_port": port,
  "local_port": 1080,
  "password": "password",
  "timeout": 600,
  "method": "aes-256-cfb"
}
```

<p lang="fa" dir="rtl" align="right">و دستور رو اینجوری زد</p>

```bash
$ sslocal -c path_file
```

<p lang="fa" dir="rtl" align="right">شدو ساکس در پورت‌های مختلف و انکریپشن‌های متفاوت سرعت‌های مختلفی میده، فرود در این زمینه اطلاعات دقیق و کاملی داره</p>
<h2 lang="fa" dir="rtl" align="right">ساختن پروکسی ساکس با استفاده از ssh</h2>
<p lang="fa" dir="rtl" align="right">
اگر دسترسی ssh به یک سرور دارید می‌تونید به این طریق یک تونل رو سیستم خودتون ایجاد کنید
به این ترتیب با برقراری کانکشن ssh یک تونل proxy socks5 رو پورت ۱۰۸۰ سیستمتون ایجاد میشه
</p>

```bash
$ ssh user@server.address -D 1080
```

<div lang="fa" dir="rtl" align="right">

## تونل با کمک تور

تور یکی از امن ترین شبکه‌های دنیاست

برای استفاده از تور روی لینوکس 2 راه وجود داره

1.  ### استفاده از مرورگر تور
    - [TOR browser for linux](https://www.torproject.org/download/)
2.  ### استفاده از تور از طریق bash

</div>

```bash
$ sudo apt install tor
$ sudo apt install python-pip
$ sudo apt install python-dev gcc
$ sudo pip install obfsproxy
```

<p lang="fa" dir="rtl" align="right">سپس تنظیمات تور رو باید انجام بدید</p>

```bash
$ sudo nano /etc/tor/torrc
```

<p lang="fa" dir="rtl" align="right">موارد زیر رو به انتهای فایل اضافه کنید
با کنترل + c و انتخاب y می‌تونید تغییرات رو ذخیره کنید</p>

```
SocksPort 1080
SocksListenAddress 127.0.0.1
Bridge obfs3 194.132.209.187:39413
Bridge obfs3 194.68.32.131:56006
Bridge obfs3 107.191.58.23:34344
UseBridges 1
ClientTransportPlugin obfs2,obfs3 exec /usr/local/bin/obfsproxy --managed
```

<div lang="fa" dir="rtl" align="right">تعدادی از پل‌های تور هم در این تنظیمات هستند، پل‌ها ممکن است بسته شوند از https://bridges.torproject.org می‌تونید پل‌های جدید بگیرید و با موارد بالا جایگزین کنید.

بعد ذخیره تنظیمات با دستور زیر تور را دوباره راه‌اندازی کنید

برای راه اندازی دوباره در ubuntu و لینوکس های دیگر مبتنی بر debian

</div>

```bash
$ sudo service tor restart
```

<div dir="rtl">
و برای لینوکس های مبتنی بر red hat مثل centOS و fedora:

</div>

```bash
$ sudo systemctl restart tor.service
```

<div lang="fa" dir="rtl" align="right">حالا تونل در سیستم شما اجرا شده و لازمه ترافیک رو ازش رد کنید

برای اینکه از اتصال سیستم خود به شبکه جهانی اطمینان حال کنید میتونید لاگ های سیستم رو بخونید و اگر در لاگفایل و در خطوط آخر این عبارت `Bootstrapped 100%`
به چشم خود پس ارتباط برقراره ، درغیر این صورت bridge ها رو عوض کنید

برای دیدل لاگ ها

</div>

```bash
$ sudo journalctl --unit tor.service
```

<div lang="fa" dir="rtl" align="right">

## ساخت تونل tor به کمک termux برای android

برنامه termux شبیه ساز bash برای اندرویده البته برای استفاده کامل از تمام توانایی های این برنامه میتونید گوشیتون رو روت کنید ولی برای کاری که ما الان میخواهیم انجام بدیم نیازی به این کار نیست

پس اول termux رو باز کنید و دستور های زیر رو به ترتیب اجرا کنید

</div>

```bash
apt update
apt install tor -y
apt install nano -y
pkg install tor obfs4proxy -y
```

<p lang="fa" dir="rtl" align="right">
حالا برای اجرای tor خیلی راحت و با تایپ tor برنامه را اجرا میکنیم
</p>

```bash
$ tor
```

<div lang="fa" dir="rtl" align="right">
پس صبر میکنیم تا ارتباط برقرار بشه
اگر این رو تو خط آخر میبینید پس ارتباط برقراره

`Bootstrapped 100%`

در غیر این صورت ارتباط شما از طرف شرکت ISP محدود شده و باید از bridge استفاده کنید

اول یه فایل جدید ایجاد کنید

</div>

```bash
touch torrc
```

<p dir="rtl">
و بعد فایل ایجاد شده رو ویرایش میکنیم 
</p>

```bash
nano torrc
```

<div dir="rtl">
و brighe ها رو داخلش اضافه میکنیم

**چند bridge به عنوات مثال زکر شده که در صورت عدم برقراری ارتباط باید با bridge های جدید جایگزین بشن**

</div>

```bash
ClientTransportPlugin obfs4 exec /data/data/com.termux/files/usr/bin/obfs4proxy managed

bridge obfs4 213.243.143.43:58069 A9405AA8593B081440179DFE799B5D31E4BF993D cert=ewT0kbQLNazoKj2oocZErGoQopUBBMW7syY1wVEgmpDgHoevmbiZnWN8seo4XSIp8rILfg iat-mode=0

bridge obfs4 172.86.144.104:443 3F437A9AB9D086322F4FAD1B658EFEF9B2B8B64E cert=6MYDi1ir/HjySknjeaG+hs07FZfYUhlOpAYdxifK80ISMISe+9EJp4t5dq4XIrRh4G1jKg iat-mode=0

bridge obfs4 38.229.33.140:57275 EC4F9DA66F520A094E5B534AA08DFC1AB5E95B64 cert=OJJtSTddonrjXMCWGX97lIagsGtGiFnUI6t/OGFbKtpvWiFEfS0sLBnhLmHUENLoW1soeg iat-mode=1

bridge obfs4 89.73.45.215:53577 59A6C7C9CB0212C1E3AB0EA0BB0A3C0E6466D574 cert=55UHcb9tANMEh5ClLzFQxGHjVH1XdoHota/5IeeNfJDaFg2h6vBbuwpWAtDMxZe2CTJOOg iat-mode=0

SOCKSPort 127.0.0.1:9050 # برای تغییر اینترفیس و پورت تونل ساکس ایجاد شده

HTTPTunnelPort 127.0.0.1:9080  # برای باز کردن تونل اچ تی تی پی با پورت و اینترفیس دلخواه
```

<div dir="rtl">
 برای اجرا TOR داخل Termux 
</div>

```bash
$ tor -f torrc
```

<div lang="fa" dir="rtl" align="right">

## استفاده از پروکسی geph

یکی از قدرتمند ترین proxy های http و socks5 برای انواع پلت فرم ها از جمله لینوکس

[https://geph.io](https://geph.io/en/)

ویژگی های geph

- مقاومت در برابر سفیلترینگ
- رابط کاربری ساده
- بدون نیاز به نصب
- قابلیت گوش کردن روی interface هایی غیر از 127.0.0.1
- پروکسی socks و http

<img src="sceenshots/geph.png" alt="geph sceenshot" width="250"/>


## ساخت تونل با yourfreedom

باید قبلش برید تو سایتش ثبت‌نام کنید

از قسمت دانلود نسخه جاوا دانلود کنید

از حالت فشرده خارج کنید

با cd به محل اکسترکت شده برید و دستور زیر رو وارد کنید

</div>

```bash
$ java -jar freedom.jar
```

<div lang="fa" dir="rtl" align="right">
حواستون باشه که لازمه قبلش جاوا رو نصب کرده باشید. اگر برای نصب جاوا به مشکل خوردید بگید شاید برای اونم یه چیزی ردیف کردیم.

خوب فیریدام باید اجرا شه. در اولین دفعه خودش پنجره کانفیگ رو باز می‌کنه، اگر بعد از مدتی دیدید کنده یا کار نمی‌کنه دوباره از همین قسمت دنبال سرور‌های جدید بگردید.

در پنجره کانفیگ چندین بار نکست رو بزنید تا شروع کنه دنبال سرورهاش بگرده (طول میکشه)
بعد از پیدا شدن سرورها یکیش رو انتخاب کنید و نکست رو بزنید.

یوزر و پسورد اکانتتون رو وارد کنید، ذخیره کنید و بیاید بیرون

استارت کانکشن رو بزنید بعد از چند ثانیه ارتباط برقرار میشه

## openvpn

از openvpn هم میشه در لینوکس استفاده کرد اول نصبش کنید (فایل کانفیگ رو یا یا خودتون باید تو سرورتون بسازید یا از کسی که دارید از سرویسش استفاده می‌کنید بگیرید)

</div>

```bash
$ sudo apt install openvpn
```

<p lang="fa" dir="rtl" align="right">فایل کانفیگ openvpn رو دانلود کنید و به این طریق وصل شید</p>

```bash
$ sudo openvpn /path/to/config_file.ovpn
```

<div lang="fa" dir="rtl" align="right">

با اجرا این دستور کل ترافیک شما میره سمت سرور و لازم نیست پراکسی جایی ست کنید، در نتیجه تمام تنظیمات پراکسی‌هاتون رو مستقیم کنید.

## رد کردن ترافیک از تونل

اگر دقیقا مثل تنظیماتی که نشون دادیم جلو رفته باشید با هر کدوم از روش‌ها یه تونل از نوع socks5 رو پورت 1080 و آی‌پی سیتمتون 127.0.0.1 دارید.

حالا باید هر چیزی رو که می‌خواید از توی این تونل رد کنید.
خود سیستم عامل تو قسمت نتورک تنظیماتی برای پراکسی داره ولی من ازش خوشم نمیاد و فکر کنم بعضی از برنامه‌ها به اون تنظیمات کاری ندارند.

روش‌های بهتری هم هست

## فایرفکس

foxyproxy یه پلاگین برای فایرفکس و فکر کنم کروم هست که می‌تونید خیلی راحت و دم دستی تنظیمات پراکسی رو توش تغییر بدید.

پلاگین رو نصب کنید، add new proxy رو بزنید، ip رو 127.0.0.1 و پورت 1080 بزارید، نوع پراکسی رو socks5 انتخاب کنید و ذخیره کنید.

از قسمت مود پراکسی‌ای که ساختید رو فعال کنید.
نکته:‌بدون این پلاگین هم میشه از تنظیمات فایرفکس پراکسی رو تغییر داد ولی این دم دسته
می‌تونید تنظیمات دیگه‌ای هم بهش اضافه کنید مثلا aparat.com رو از پراکسی رد نکنه تا سرعت بالاتری داشته باشه

## کروم

اکستنشنی هست به نام SwitchyOmega که می‌تونه تنظیمات پراکسی کروم رو باهاش دست کاری کرد. نصبش کنید.

کنار آدرس بار آیکنش اضافه می‌شه از option گزینه new profile رو انتخاب کنید، یه اسم براش وارد کنید و گزینه proxy profile رو بزنید. پروتکل رو socks5 انتخاب کنید. سرور 127.0.0.1 و پورت 1080 باشه در انتها هم apply change رو بزنید.

هر وقت خواستید می‌تونید با کلیک رو آیکنش به راحتی ارتباط رو مستقیم کنید یا از پراکسی رد کنید.

تنظیمات دیگه‌ای هم داره مثلا بزنید تمام سایت‌هایی که با ir تموم میشند بدون پراکسی باشند.

## ترمینال

گاهی لازمه ترافیک ترمینال هم از پراکسی رد شه، مثلا زمانی که می‌خواید کروم رو آپدیت کنید یا برای نصب جاوا و … چون این شرکت‌ها مارو تحریم کردند.<br>برنامه‌ای هست به نام proxychains اول هر کامندی که بزنید ترافیکش از پراکسی رد میشه، اول نصبش کنید

</div>

```bash
$ sudo apt install proxychains
```

<p lang="fa" dir="rtl" align="right">بعد کامند زیر رو بزنید</p>

```bash
$ sudo nano /etc/proxychains.conf
```

<p lang="fa" dir="rtl" align="right">به آخر فایل برید و اول خط آخر یک # اضافه کنید تا کامنت شه
و خط زیر به آخرش اضافه کنید</p>

```
socks5  127.0.0.1 1080
```

<div lang="fa" dir="rtl" align="right">

خوب حالا می‌تونید با زدن proxychains اول هر دستوری ترافیکش رو از تونل رد کنید.

نکته اگر می‌خواید سیستم تون رو آپدیت کنید اول sudo -s و بعدش proxychains apt update

## تبدیل socks5 به http

هنوز یه مشکلی هست بعضی از برنامه‌ها تو تنظیمات پراکسیشون socks5 ندارند. مثل اندروید استادیو و sdk! در نتیجه نمیشه sdk رو آپدیت کرد چون گوگل تحریممون کرده، بنابراین ما socks5 رو تبدیل میکنیم به http می‌کنیم که این برنامه‌ها ازش پشتیبانی می‌کنند. به کمک برنامه polipo که مثل یه شلنگ می‌مونه، از یه ور socks5 می‌گیره از یه ور دیگه http تحویل میده</div>

```bash
sudo apt install polipo
```

<p lang="fa" dir="rtl" align="right">و بعد برای کافیگش دو خط زیر رو</p>

```
socksParentProxy = localhost:1080
socksProxyType = socks5
```

<p lang="fa" dir="rtl" align="right">به انتهای فایل</p>

```bash
$ sudo nano /etc/polipo/config
```

<p lang="fa" dir="rtl" align="right">اضافه کنید با کنترل + c و انتخاب y تغییرات رو ذخیره کنید و بعدش Polipo رو ری‌استارت کنید</p>

```bash
$ sudo service polipo restart
```

<p lang="fa" dir="rtl" align="right">حالا یه پراکسی دیگه هم رو سیستم داریم همون آی‌پی 127.0.0.1 ولی رو پورت 8123 و از نوع http که به راحتی می‌تونید رو همه سیستم‌ها از جمله اندروید استادیو اضافش کنید</p>

<h2 lang="fa" dir="rtl" align="right">و در آخر</h2>
<p lang="fa" dir="rtl" align="right">اگر جایی نا واضح هست بگید با افزودن عکس یا توضیحات دقیق‌تر بهترش کنیم.<br>اگر چیزی کار نکرد ارور رو به دقت مطالعه کنید سعی کنید برطف کنید، نشد سرچ، نشد بچه‌های کامینیوتی از جمله خودم در فروم‌ها، irc و … کمکتون می‌کنیم.</p>
